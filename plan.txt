                       One root acc
One reseller acc
Two admin acc
One enduser acc

Current system role stream
root->reseller->admin->enduser

To check credit allocation flow
root->reseller | allow CHECKED
reseller->root | don’t allow CHECKED
reseller->admin CHECKED
admin->admin CHECKED
admin->upstream CHECKED
<Need one admin acc> (checked)
admin->enduser CHECKED

Root id = 1
Reseller id = 2
Admin testing id = 130
Admin id = 104
Enduser id = 1

Root account payload
{
  "username": "aplusbinary@outlook.com",
  "password": "qweqwe123"
}

Reseller account payload
{
  "username": "reseller@aplusbinary.com",
  "password": "qweqwe123"
}

Admin account payload
{
  "username": "admin@gmail.com",
  "password": "0000000000"
}

End User account payload
{
  "username": "enduser@gmail.com",
  "password": "0000000000"
}

Root creates package 
Created package will be able to buy by resellers
Admin check purchase packages
Admin approve PENDING purchases and credit will allocate to reseller
Admin refund COMPLETED purchases and credit will reduce for specific reseller

Credit buy flow to admin
Approved by reseller
Reseller must have enough credits to approve the incoming purchases

To check

Root create 1000, and 2000 credit package 	CHECKED
	View all package route by root 		CHECKED			
	View all package by reseller			CHECKED	
	View all package by admin			CHECKED

Reseller bought 1000 credit package		CHECKED
	See status change PENDING			CHECKED
	See my purchase route PENDING		CHECKED	

Root check all purchases route PENDING		CHECKED
Root approve package purchase COMPLETE		CHECKED
	See credit changes				CHECKED

Admin bought 2000 valued package			CHECKED
	See status change					CHECKED

Reseller check its child purchased package	CHECKED
Reseller approve the purchases (must fail)	CHECKED

Reseller bought another 1000 package,		CHECKED
root approve

Reseller again approve the purchases (must success) CHECKED

Admin allocation plan

Admin allocate credit to admin			CHECKED
	See parent amount					CHECKED
	See child amount					CHECKED
Admin allocate credit to end-user			CHECKED
	See parent amount					CHECKED
	See child amount					CHECKED


To reserve (admin, enduser)
On start = call api with amount->reserve in table->return with reserve_id
On complete success = call api with reservation id->credit reduce
On complete failure = call api with reservation id -> credit revoke

TODO:
License assign api admin->admin (not allow)		DONE
Create account api admin->admin (not allow)		DONE
Add enduser deleted route by parent admin		DONE
TOFIX:
Associated count 0 in role list (admin side) 		DONE

TOCHECK:
Reseller delete inactive admin that has a related child account will it delete all?								YES



Role id 7

To add category parameter in license update route	DONE
Link database in warehouse system backend		DONE
Add swagger for warehouse system				DONE

WAREHOUSE PAGINATION CHECK

Warehouse pagination						EXIST
Production pagination 						EXIST
Storage pagination						EXIST
Supplier pagination						EXIST
Shipment pagination						EXIST
Stock pagination							EXIST

Warehouse System Checking
Change File Path from Properties				DONE
Appearing extra header for file import			FIXED
Product file import,export					CHECK
Storage file import,export					CHECK
Supplier file import,export					CHECK

Shipment file import didn’t show specific column duplication error
, export is ok								CHECK

Importing file template
 - add new route for downloading new template			DONE
 - check whether each column has correct header or no	DONE

Doc System
@ConditionalOnProperty
Clean up hour properties didn’t use for now

Watched models
DocumentProcessingLog								DONE
Invoice										DONE

createTempInvoice();								DONE
cleanUpPreviousSuccessfulTempInvoices();				DONE
createTempFile();									DONE
extractText();									DONE
parseInvoiceEntitiesWithData();						DONE
copyFromParsedInvoice();							DONE
validateTempInvoice();								DONE
uploadToS3withRetry();								DONE

INVOICE
Invoice Number: INN-1001
Invoice Date: 2025-01-10
Vendor: Hlyam Supplies
Item: Widget B  Qty:2  Unit:50.00
Subtotal: 100.00
Tax: 7.50
Total: 107.50 USD


Pricing Service

Configure app.accountmanagement.base-url, app.pricing.operation-code.invoice-upload, app.pricing.minimum-reservation, and app.credit.reservation.ttl-seconds in your environment as needed.
The flow still returns a temp-invoice payload; promotion to a persisted Invoice is not yet implemented (task remains).
Pricing estimation is best-effort (file size + simple heuristics). Refine PricingService once unit costs/unit names are finalized.
If you want the credit reservation amount to match actual post-processing usage, we can add a second-pass adjustment or a more accurate usage model.




+--------------------------+---------------+-------------------+-----------+------------------------+
| pricing_code             | pricing_model | service_name      | unit_cost | unit_name              |
+--------------------------+---------------+-------------------+-----------+------------------------+
| OCR_PER_PAGE             | PER_PAGE      | OCR Processing    |  0.100000 | page                   |
| GPT_INPUT_PER_1K_TOKENS  | PER_TOKEN     | LLM Input Tokens  |  0.050000 | input_tokens_per_1000  |
| GPT_OUTPUT_PER_1K_TOKENS | PER_TOKEN     | LLM Output Tokens |  0.050000 | output_tokens_per_1000 |
| S3_STORAGE_PER_MB        | PER_MB        | Storage           |  0.010000 | mb                     |
+--------------------------+---------------+-------------------+-----------+------------------------+


file_size=339kb
gpt_iniput_token=514

Operation code = INVOICE_UPLOAD = credit_cost 1
4 pricing mapping all multiplier is 1
	Ocr per page
	LLM input
	LLM output
	Storage per MB

Token calculation flow
1 word is 1 token and 8 character is 1 token


Need error handling for duplicate invoice file upload


Delete account flow
Root delete reseller		FINE
Reseller delete admin		FINE


